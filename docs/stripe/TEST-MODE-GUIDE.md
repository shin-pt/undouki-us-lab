# テストモードの使い方ガイド

## テストモードとは？

テストモードは、**実際のStripe決済を行わずに**プラン登録をテストできる機能です。
開発や動作確認の際に便利です。

## テストモードの特徴

✅ **メリット**
- 実際の決済が発生しない（お金がかからない）
- すぐにプランを変更できる
- Stripeの設定がなくても動作確認できる
- ローカル環境でも動作する

⚠️ **注意点**
- 実際の決済フローはテストできない
- Stripe Payment Linksの動作確認はできない

## 使い方（ステップバイステップ）

### ステップ1: テストモードでページを開く

ブラウザのアドレスバーに以下を入力：

```
plans.html?test=true
```

**例：**
- ローカルサーバーを使用している場合: `http://localhost:8000/plans.html?test=true`
- ファイルを直接開いている場合: `file:///Users/shinyamacbook/Desktop/undouki-us-lab/plans.html?test=true`

### ステップ2: ログインする

1. テストモードでページを開くと、ログインしていない場合は`auth.html`にリダイレクトされます
2. 既存のアカウントでログインするか、新規アカウントを作成してください

### ステップ3: プランを選択

1. `plans.html?test=true`に戻ります
2. 現在のプランが表示されます（未登録の場合は「未登録」と表示）
3. 登録したいプランのボタンをクリック：
   - **1980円プラン**の「このプランに登録」ボタン
   - **2980円プラン**の「このプランに登録」ボタン

### ステップ4: 確認ダイアログで確認

確認ダイアログが表示されます：

```
1980円プランに登録しますか？

※テストモード：実際の決済は行われません
```

または

```
2980円プランに登録しますか？

※テストモード：実際の決済は行われません
```

「OK」をクリックしてください。

### ステップ5: プランが更新される

1. プラン情報がFirestoreに直接保存されます
2. 成功メッセージが表示されます：
   ```
   プランが1980円プランに更新されました。
   ```
   または
   ```
   プランが2980円プランに更新されました。
   ```
3. 3秒後に自動的に`salon.html`にリダイレクトされます

### ステップ6: 動作確認

1. `salon.html`でプラン情報が正しく表示されることを確認
2. プラン制限のあるコンテンツにアクセスできることを確認

## 通常モードとの違い

| 項目 | テストモード | 通常モード |
|------|------------|-----------|
| URL | `plans.html?test=true` | `plans.html` |
| 決済 | 発生しない | Stripe決済が発生 |
| プラン更新 | 直接Firestoreに保存 | Stripe決済完了後に保存 |
| リダイレクト | `salon.html`に直接移動 | Stripe → `plan-success.html` → `salon.html` |
| 確認メッセージ | 「テストモード：実際の決済は行われません」 | 「Stripe決済ページに移動します」 |

## 実際の使用例

### 例1: 1980円プランに登録する

1. `plans.html?test=true`にアクセス
2. 「1980円プラン」の「このプランに登録」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. プランが更新され、`salon.html`にリダイレクト

### 例2: 2980円プランに変更する

1. `plans.html?test=true`にアクセス（現在1980円プランに登録済み）
2. 「2980円プラン」の「プランを変更する」ボタンをクリック
3. 確認ダイアログで「OK」をクリック
4. プランが更新され、`salon.html`にリダイレクト

### 例3: プランを解除する（未登録に戻す）

現在の実装では、プランを解除する機能はありません。
Firestoreで直接`plan`フィールドを`null`に設定する必要があります。

## トラブルシューティング

### Q: テストモードでページを開いても、通常モードと同じ動作をする

**A:** URLパラメータが正しく設定されているか確認してください。
- ✅ 正しい: `plans.html?test=true`
- ❌ 間違い: `plans.html?test=1` または `plans.html?test`

### Q: ログインしていない状態でテストモードを開くとどうなる？

**A:** `auth.html`にリダイレクトされます。ログイン後、`plans.html`に戻る必要があります。
その際、URLパラメータ`?test=true`が失われる可能性があるので、再度追加してください。

### Q: プランが更新されない

**A:** 以下を確認してください：
1. Firebase Authenticationでログインしているか
2. Firestoreのセキュリティルールが正しく設定されているか
3. ブラウザのコンソール（F12）でエラーがないか確認

## 次のステップ

テストモードで動作確認が完了したら：

1. **通常モードで動作確認**
   - `plans.html`（`?test=true`なし）にアクセス
   - Stripe Payment Linksの動作を確認

2. **本番環境にデプロイ**
   - すべての動作確認が完了したら
   - 本番環境用のStripe Payment Linksを設定
   - 実際のドメインにアップロード

